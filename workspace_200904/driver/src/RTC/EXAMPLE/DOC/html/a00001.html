<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>AVR32 UC3 - Real Time Counter Driver: rtc.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>rtc.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
RTC driver for AVR32 UC3. 
<p>
AVR32 Real Time Counter driver module.<p>
<ul>
<li>Compiler: GNU GCC for AVR32</li><li>Supported devices: All AVR32 devices with an RTC and a PM module can be used.</li><li>AppNote:</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>
Definition in file <a class="el" href="a00004.html">rtc.c</a>.
<p>
<code>#include &quot;<a class="el" href="a00005.html">rtc.h</a>&quot;</code><br>
<code>#include &quot;pm.h&quot;</code><br>

<p>
<a href="a00004.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#ebbffe0776600ab5176e15074975ec72">rtc_clear_interrupt</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clear the interruption flag. Call this function once you handled the interruption.  <a href="#ebbffe0776600ab5176e15074975ec72"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#b56680c3df3e33edda60f07bb829cf9d">rtc_disable</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disable the RTC.  <a href="#b56680c3df3e33edda60f07bb829cf9d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#01bc5d9a8098dc21be7f1c19719b87ef">rtc_disable_interrupt</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disable the interruption feature of the RTC.  <a href="#01bc5d9a8098dc21be7f1c19719b87ef"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#b1fd4b1641d0195d914a423033391b90">rtc_disable_wake_up</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disable the wake up feature of the RTC.  <a href="#b1fd4b1641d0195d914a423033391b90"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#3ac9dd15e1875dc482d168369509e8f0">rtc_enable</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable the RTC.  <a href="#3ac9dd15e1875dc482d168369509e8f0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#27a9570fcb932ea95149b4143f933fa0">rtc_enable_interrupt</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable the interruption feature of the RTC. An interrupt is raised when the value of the RTC is equal to its top value.  <a href="#27a9570fcb932ea95149b4143f933fa0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#bc0d583cefaada72a9854fbc354270e6">rtc_enable_wake_up</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable the wake up feature of the RTC.  <a href="#bc0d583cefaada72a9854fbc354270e6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#037653282e369e9c96fe8ebdec8c00cb">rtc_get_top_value</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the RTC current top value.  <a href="#037653282e369e9c96fe8ebdec8c00cb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#3834c4bc54b9985526a686679e3ce3a5">rtc_get_value</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the RTC current value.  <a href="#3834c4bc54b9985526a686679e3ce3a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#032b4b25cef27362ebcbc10711c84d05">rtc_init</a> (volatile avr32_rtc_t *rtc, unsigned char osc_type, unsigned char psel)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function will initialise the RTC module. If you use the 32 KHz oscillator, it will enable this module. This function also set the top value of the RTC to 0xFFFFFFFF and the value to 0.  <a href="#032b4b25cef27362ebcbc10711c84d05"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#ae220ea4e1dfaea7564ca60e5294471f">rtc_interrupt_enabled</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the status of interrupts.  <a href="#ae220ea4e1dfaea7564ca60e5294471f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the RTC is busy or not.  <a href="#625597f30ed167077eeaa6b11b256d8b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#5b3625f2feec32152780fd901c617160">rtc_is_interrupt</a> (volatile avr32_rtc_t *rtc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if an interrupt is raised.  <a href="#5b3625f2feec32152780fd901c617160"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#97679dbd71ec61bc1e92bbfeee9e0635">rtc_set_top_value</a> (volatile avr32_rtc_t *rtc, unsigned long top)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function sets the RTC current top value.  <a href="#97679dbd71ec61bc1e92bbfeee9e0635"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html#436be7047e8404db9c559199c25c6993">rtc_set_value</a> (volatile avr32_rtc_t *rtc, unsigned long val)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function sets the RTC current value.  <a href="#436be7047e8404db9c559199c25c6993"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ebbffe0776600ab5176e15074975ec72"></a><!-- doxytag: member="rtc.c::rtc_clear_interrupt" ref="ebbffe0776600ab5176e15074975ec72" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_clear_interrupt           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clear the interruption flag. Call this function once you handled the interruption. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00164">164</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
Referenced by <a class="el" href="a00006.html#l00126">rtc_irq()</a>.<div class="fragment"><pre class="fragment"><a name="l00165"></a>00165 {
<a name="l00166"></a>00166      rtc-&gt;ICR.topi = 1;
<a name="l00167"></a>00167 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b56680c3df3e33edda60f07bb829cf9d"></a><!-- doxytag: member="rtc.c::rtc_disable" ref="b56680c3df3e33edda60f07bb829cf9d" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_disable           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disable the RTC. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00140">140</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.<div class="fragment"><pre class="fragment"><a name="l00141"></a>00141 {
<a name="l00142"></a>00142      <span class="keywordtype">int</span> ctrl;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144      <span class="comment">// Wait until the rtc CTRL register is up to date</span>
<a name="l00145"></a>00145      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00146"></a>00146      <span class="comment">// Read the current configuration</span>
<a name="l00147"></a>00147      ctrl = rtc-&gt;ctrl;
<a name="l00148"></a>00148      <span class="comment">// Disable the RTC</span>
<a name="l00149"></a>00149      rtc-&gt;ctrl = ctrl &amp; (~AVR32_RTC_CTRL_EN_MASK);
<a name="l00150"></a>00150      <span class="comment">// Wait until write is done</span>
<a name="l00151"></a>00151      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00152"></a>00152 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="01bc5d9a8098dc21be7f1c19719b87ef"></a><!-- doxytag: member="rtc.c::rtc_disable_interrupt" ref="01bc5d9a8098dc21be7f1c19719b87ef" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_disable_interrupt           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disable the interruption feature of the RTC. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00159">159</a> of file <a class="el" href="a00004.html">rtc.c</a>.<div class="fragment"><pre class="fragment"><a name="l00160"></a>00160 {
<a name="l00161"></a>00161      rtc-&gt;IDR.topi = 1;
<a name="l00162"></a>00162 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b1fd4b1641d0195d914a423033391b90"></a><!-- doxytag: member="rtc.c::rtc_disable_wake_up" ref="b1fd4b1641d0195d914a423033391b90" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_disable_wake_up           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disable the wake up feature of the RTC. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00116">116</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.<div class="fragment"><pre class="fragment"><a name="l00117"></a>00117 {
<a name="l00118"></a>00118      <span class="keywordtype">int</span> ctrl;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120      <span class="comment">// Wait until the rtc CTRL register is up to date</span>
<a name="l00121"></a>00121      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00122"></a>00122      <span class="comment">// Read the current configuration</span>
<a name="l00123"></a>00123      ctrl = rtc-&gt;ctrl;
<a name="l00124"></a>00124      <span class="comment">// Disable the wake up of the RTC</span>
<a name="l00125"></a>00125      rtc-&gt;ctrl = ctrl &amp; (~AVR32_RTC_CTRL_WAKE_EN_MASK);
<a name="l00126"></a>00126      <span class="comment">// Wait until write is done</span>
<a name="l00127"></a>00127      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00128"></a>00128 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3ac9dd15e1875dc482d168369509e8f0"></a><!-- doxytag: member="rtc.c::rtc_enable" ref="3ac9dd15e1875dc482d168369509e8f0" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_enable           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Enable the RTC. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00130">130</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.
<p>
Referenced by <a class="el" href="a00006.html#l00158">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00131"></a>00131 {
<a name="l00132"></a>00132      <span class="comment">// Wait until the rtc CTRL register is up to date</span>
<a name="l00133"></a>00133      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00134"></a>00134      <span class="comment">// Enable the RTC</span>
<a name="l00135"></a>00135      rtc-&gt;ctrl |= 1 &lt;&lt; AVR32_RTC_CTRL_EN_OFFSET;
<a name="l00136"></a>00136      <span class="comment">// Wait until write is done</span>
<a name="l00137"></a>00137      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00138"></a>00138 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="27a9570fcb932ea95149b4143f933fa0"></a><!-- doxytag: member="rtc.c::rtc_enable_interrupt" ref="27a9570fcb932ea95149b4143f933fa0" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_enable_interrupt           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Enable the interruption feature of the RTC. An interrupt is raised when the value of the RTC is equal to its top value. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00154">154</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
Referenced by <a class="el" href="a00006.html#l00158">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00155"></a>00155 {
<a name="l00156"></a>00156      rtc-&gt;IER.topi = 1;
<a name="l00157"></a>00157 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bc0d583cefaada72a9854fbc354270e6"></a><!-- doxytag: member="rtc.c::rtc_enable_wake_up" ref="bc0d583cefaada72a9854fbc354270e6" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_enable_wake_up           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Enable the wake up feature of the RTC. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00106">106</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.<div class="fragment"><pre class="fragment"><a name="l00107"></a>00107 {
<a name="l00108"></a>00108      <span class="comment">// Wait until the rtc CTRL register is up to date</span>
<a name="l00109"></a>00109      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00110"></a>00110      <span class="comment">// Enable the wake up of the RTC</span>
<a name="l00111"></a>00111      rtc-&gt;ctrl |= 1 &lt;&lt; AVR32_RTC_CTRL_WAKE_EN_OFFSET;
<a name="l00112"></a>00112      <span class="comment">// Wait until write is done</span>
<a name="l00113"></a>00113      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00114"></a>00114 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="037653282e369e9c96fe8ebdec8c00cb"></a><!-- doxytag: member="rtc.c::rtc_get_top_value" ref="037653282e369e9c96fe8ebdec8c00cb" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long rtc_get_top_value           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the RTC current top value. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The RTC current top value. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00179">179</a> of file <a class="el" href="a00004.html">rtc.c</a>.<div class="fragment"><pre class="fragment"><a name="l00180"></a>00180 {
<a name="l00181"></a>00181      <span class="keywordflow">return</span> rtc-&gt;top;
<a name="l00182"></a>00182 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3834c4bc54b9985526a686679e3ce3a5"></a><!-- doxytag: member="rtc.c::rtc_get_value" ref="3834c4bc54b9985526a686679e3ce3a5" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long rtc_get_value           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the RTC current value. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The RTC current value. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00101">101</a> of file <a class="el" href="a00004.html">rtc.c</a>.<div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103      <span class="keywordflow">return</span> rtc-&gt;val;
<a name="l00104"></a>00104 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="032b4b25cef27362ebcbc10711c84d05"></a><!-- doxytag: member="rtc.c::rtc_init" ref="032b4b25cef27362ebcbc10711c84d05" args="(volatile avr32_rtc_t *rtc, unsigned char osc_type, unsigned char psel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_init           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>osc_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>psel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function will initialise the RTC module. If you use the 32 KHz oscillator, it will enable this module. This function also set the top value of the RTC to 0xFFFFFFFF and the value to 0. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>osc_type</em>&nbsp;</td><td>The oscillator you want to use. If you need a better accuracy, use the 32 KHz oscillator (i.e. RTC_OSC_32KHZ). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>psel</em>&nbsp;</td><td>The preselector value for the corresponding oscillator (4-bits). To obtain this value, you can use this formula: psel = log(Fosc/Frtc)/log(2)-1, where Fosc is the frequency of the oscillator you are using (32 KHz or 115 KHz) and Frtc the frequency desired. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if the initialisation succeds otherwize it will return 0. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00052">52</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>, <a class="el" href="a00005.html#l00062">RTC_OSC_32KHZ</a>, <a class="el" href="a00004.html#l00169">rtc_set_top_value()</a>, and <a class="el" href="a00004.html#l00091">rtc_set_value()</a>.
<p>
Referenced by <a class="el" href="a00006.html#l00158">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00053"></a>00053 {
<a name="l00054"></a>00054      <span class="keywordtype">int</span> ctrl;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056      <span class="comment">// if we use the 32KHz oscillator, we have to enable it first</span>
<a name="l00057"></a>00057      <span class="keywordflow">if</span> (osc_type == <a class="code" href="a00002.html#9e38162ea14c10e21fda955f3d99d958">RTC_OSC_32KHZ</a>)
<a name="l00058"></a>00058      {
<a name="l00059"></a>00059           <span class="comment">// Select the 32 KHz oscillator crystal</span>
<a name="l00060"></a>00060           pm_enable_osc32_crystal(&amp;AVR32_PM);
<a name="l00061"></a>00061           <span class="comment">// Enable the clock 32 KHz</span>
<a name="l00062"></a>00062           pm_enable_clk32_no_wait(&amp;AVR32_PM, 0);
<a name="l00063"></a>00063      }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065      <span class="comment">// Wait until the rtc CTRL register is up to date</span>
<a name="l00066"></a>00066      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00067"></a>00067 
<a name="l00068"></a>00068      <span class="comment">// Set the ctrl value to configure the RTC</span>
<a name="l00069"></a>00069      ctrl =
<a name="l00070"></a>00070          (((int) osc_type) &lt;&lt; AVR32_RTC_CTRL_CLK32_OFFSET)
<a name="l00071"></a>00071      |   (((<span class="keywordtype">int</span>) psel) &lt;&lt; AVR32_RTC_CTRL_PSEL_OFFSET);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073      <span class="comment">// Set the new configuration</span>
<a name="l00074"></a>00074      rtc-&gt;ctrl = ctrl;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076      <span class="comment">// Wait until write is done</span>
<a name="l00077"></a>00077      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00078"></a>00078 
<a name="l00079"></a>00079      <span class="comment">// if exit, it means that the configuration has not been set correctly</span>
<a name="l00080"></a>00080      <span class="keywordflow">if</span> (rtc-&gt;ctrl != ctrl)
<a name="l00081"></a>00081           <span class="keywordflow">return</span> 0;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083      <span class="comment">// Set the counter value to 0</span>
<a name="l00084"></a>00084      <a class="code" href="a00001.html#436be7047e8404db9c559199c25c6993">rtc_set_value</a>(rtc, 0);
<a name="l00085"></a>00085      <span class="comment">// Set the top value to 0xFFFFFFFF</span>
<a name="l00086"></a>00086      <a class="code" href="a00001.html#97679dbd71ec61bc1e92bbfeee9e0635">rtc_set_top_value</a>(rtc, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) -1);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088      <span class="keywordflow">return</span> 1;
<a name="l00089"></a>00089 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ae220ea4e1dfaea7564ca60e5294471f"></a><!-- doxytag: member="rtc.c::rtc_interrupt_enabled" ref="ae220ea4e1dfaea7564ca60e5294471f" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_interrupt_enabled           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the status of interrupts. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if the interrupts are enabled otherwize it returns 0. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00184">184</a> of file <a class="el" href="a00004.html">rtc.c</a>.<div class="fragment"><pre class="fragment"><a name="l00185"></a>00185 {
<a name="l00186"></a>00186      <span class="keywordflow">return</span> rtc-&gt;IMR.topi;
<a name="l00187"></a>00187 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="625597f30ed167077eeaa6b11b256d8b"></a><!-- doxytag: member="rtc.c::rtc_is_busy" ref="625597f30ed167077eeaa6b11b256d8b" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_is_busy           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the RTC is busy or not. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if the RTC is busy otherwize it will return 0. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00047">47</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
Referenced by <a class="el" href="a00004.html#l00140">rtc_disable()</a>, <a class="el" href="a00004.html#l00116">rtc_disable_wake_up()</a>, <a class="el" href="a00004.html#l00130">rtc_enable()</a>, <a class="el" href="a00004.html#l00106">rtc_enable_wake_up()</a>, <a class="el" href="a00004.html#l00052">rtc_init()</a>, <a class="el" href="a00004.html#l00169">rtc_set_top_value()</a>, and <a class="el" href="a00004.html#l00091">rtc_set_value()</a>.<div class="fragment"><pre class="fragment"><a name="l00048"></a>00048 {
<a name="l00049"></a>00049      <span class="keywordflow">return</span> rtc-&gt;CTRL.busy;
<a name="l00050"></a>00050 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5b3625f2feec32152780fd901c617160"></a><!-- doxytag: member="rtc.c::rtc_is_interrupt" ref="5b3625f2feec32152780fd901c617160" args="(volatile avr32_rtc_t *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_is_interrupt           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check if an interrupt is raised. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if an interrupt is currently raised otherwize it returns 0. </dd></dl>

<p>
Definition at line <a class="el" href="a00004.html#l00189">189</a> of file <a class="el" href="a00004.html">rtc.c</a>.<div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191      <span class="keywordflow">return</span> rtc-&gt;ISR.topi;
<a name="l00192"></a>00192 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="97679dbd71ec61bc1e92bbfeee9e0635"></a><!-- doxytag: member="rtc.c::rtc_set_top_value" ref="97679dbd71ec61bc1e92bbfeee9e0635" args="(volatile avr32_rtc_t *rtc, unsigned long top)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_set_top_value           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>top</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function sets the RTC current top value. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>top</em>&nbsp;</td><td>The top value you want to store. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00169">169</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.
<p>
Referenced by <a class="el" href="a00006.html#l00158">main()</a>, and <a class="el" href="a00004.html#l00052">rtc_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171      <span class="comment">// Wait until we can write into the VAL register</span>
<a name="l00172"></a>00172      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00173"></a>00173      <span class="comment">// Set the new val value</span>
<a name="l00174"></a>00174      rtc-&gt;top = top;
<a name="l00175"></a>00175      <span class="comment">// Wait until write is done</span>
<a name="l00176"></a>00176      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00177"></a>00177 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="436be7047e8404db9c559199c25c6993"></a><!-- doxytag: member="rtc.c::rtc_set_value" ref="436be7047e8404db9c559199c25c6993" args="(volatile avr32_rtc_t *rtc, unsigned long val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_set_value           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_rtc_t *&nbsp;</td>
          <td class="paramname"> <em>rtc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>val</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function sets the RTC current value. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rtc</em>&nbsp;</td><td>Base address of the RTC (i.e. &amp;AVR32_RTC). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>val</em>&nbsp;</td><td>The value you want to store. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00004.html#l00091">91</a> of file <a class="el" href="a00004.html">rtc.c</a>.
<p>
References <a class="el" href="a00004.html#l00047">rtc_is_busy()</a>.
<p>
Referenced by <a class="el" href="a00004.html#l00052">rtc_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093      <span class="comment">// Wait until we can write into the VAL register</span>
<a name="l00094"></a>00094      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00095"></a>00095      <span class="comment">// Set the new val value</span>
<a name="l00096"></a>00096      rtc-&gt;val = val;
<a name="l00097"></a>00097      <span class="comment">// Wait until write is done</span>
<a name="l00098"></a>00098      <span class="keywordflow">while</span>(<a class="code" href="a00001.html#625597f30ed167077eeaa6b11b256d8b">rtc_is_busy</a>(rtc));
<a name="l00099"></a>00099 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Thu Sep 20 12:12:51 2007 for AVR32 UC3 - Real Time Counter Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
