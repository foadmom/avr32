<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>AVR32 - PDCA Driver: pdca_example.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>pdca_example.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
PDCA and interrupt control example. 
<p>
<ul>
<li>Compiler: IAR EWAVR32 and GNU GCC for AVR32</li><li>Supported devices: All AVR32 devices with PDCA and USART modules.</li><li>AppNote:</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>
Definition in file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
<code>#include &lt;avr32/io.h&gt;</code><br>
<code>#include &quot;intc.h&quot;</code><br>
<code>#include &quot;<a class="el" href="a00006.html">pdca.h</a>&quot;</code><br>
<code>#include &quot;usart.h&quot;</code><br>
<code>#include &quot;gpio.h&quot;</code><br>
<code>#include &quot;board.h&quot;</code><br>
<code>#include &quot;pm.h&quot;</code><br>
<code>#include &quot;ascii_anim1.h&quot;</code><br>
<code>#include &quot;ascii_anim2.h&quot;</code><br>

<p>
<a href="a00007.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#37f0c109086007dbcc10f036c3786337">AVR32_PDCA_PID_USART_TX</a>&nbsp;&nbsp;&nbsp;AVR32_PDCA_PID_USART1_TX</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#ca4339137112ed9bb3eb16fc2c51c64d">EXAMPLE_USART</a>&nbsp;&nbsp;&nbsp;(&amp;AVR32_USART1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#5a55aeab727aefc9cb401af6876342e8">EXAMPLE_USART_RX_FUNCTION</a>&nbsp;&nbsp;&nbsp;AVR32_USART1_RXD_0_0_FUNCTION</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#9457549f9c382c57a9aa13845d8698b4">EXAMPLE_USART_RX_PIN</a>&nbsp;&nbsp;&nbsp;AVR32_USART1_RXD_0_0_PIN</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#aa125c5e06106b6aa2cf639a1f8360f6">EXAMPLE_USART_TX_FUNCTION</a>&nbsp;&nbsp;&nbsp;AVR32_USART1_TXD_0_0_FUNCTION</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#74a877edf512d1db6436bd850df92bd3">EXAMPLE_USART_TX_PIN</a>&nbsp;&nbsp;&nbsp;AVR32_USART1_TXD_0_0_PIN</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The channel instance for the USART example, here PDCA channel 0 (highest priority).  <a href="#da3d11341169cdd062a138fd623d36a9"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The given example is a transfer of an ASCII animation stored in internal flash to the USART_0 output (57600 bps/8 data bits/no parity bit/1 stop bit/no flow control).  <a href="#840291bc02cba5474a4cb46a9b9566fe"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#794e33cd4b50968a9efa652c534d663d">pdca_int_handler</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The PDCA interrupt handler.  <a href="#794e33cd4b50968a9efa652c534d663d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#db5aa8d6135145ebbb865efee1c64505">pdca_set_irq</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Init interrupt controller and register pdca_int_handler interrupt.  <a href="#db5aa8d6135145ebbb865efee1c64505"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#2227072d15c6c4f0897c8d3e887eb961">usart_check_tx_status</a> (volatile avr32_usart_t *usart)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">USART test if transmit buffer is ready before launching a PDCA transfer.  <a href="#2227072d15c6c4f0897c8d3e887eb961"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#dee40b6ccff7aa7ca270f786d0a88a5a">ascii_anim1</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String for ASCII animation: this is the first part of the ASCII animation.  <a href="#dee40b6ccff7aa7ca270f786d0a88a5a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#0b8d870b2016ada3230ceed66efa8af6">ascii_anim2</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String for ASCII animation: this is the second and final part of the ASCII animation.  <a href="#0b8d870b2016ada3230ceed66efa8af6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Counter for interrupt test.  <a href="#a54dec3315fe8cf32a47d6ab284e5928"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="37f0c109086007dbcc10f036c3786337"></a><!-- doxytag: member="pdca_example.c::AVR32_PDCA_PID_USART_TX" ref="37f0c109086007dbcc10f036c3786337" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVR32_PDCA_PID_USART_TX&nbsp;&nbsp;&nbsp;AVR32_PDCA_PID_USART1_TX          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00107">107</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="ca4339137112ed9bb3eb16fc2c51c64d"></a><!-- doxytag: member="pdca_example.c::EXAMPLE_USART" ref="ca4339137112ed9bb3eb16fc2c51c64d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXAMPLE_USART&nbsp;&nbsp;&nbsp;(&amp;AVR32_USART1)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00102">102</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="5a55aeab727aefc9cb401af6876342e8"></a><!-- doxytag: member="pdca_example.c::EXAMPLE_USART_RX_FUNCTION" ref="5a55aeab727aefc9cb401af6876342e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXAMPLE_USART_RX_FUNCTION&nbsp;&nbsp;&nbsp;AVR32_USART1_RXD_0_0_FUNCTION          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00104">104</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="9457549f9c382c57a9aa13845d8698b4"></a><!-- doxytag: member="pdca_example.c::EXAMPLE_USART_RX_PIN" ref="9457549f9c382c57a9aa13845d8698b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXAMPLE_USART_RX_PIN&nbsp;&nbsp;&nbsp;AVR32_USART1_RXD_0_0_PIN          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00103">103</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="aa125c5e06106b6aa2cf639a1f8360f6"></a><!-- doxytag: member="pdca_example.c::EXAMPLE_USART_TX_FUNCTION" ref="aa125c5e06106b6aa2cf639a1f8360f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXAMPLE_USART_TX_FUNCTION&nbsp;&nbsp;&nbsp;AVR32_USART1_TXD_0_0_FUNCTION          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00106">106</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="74a877edf512d1db6436bd850df92bd3"></a><!-- doxytag: member="pdca_example.c::EXAMPLE_USART_TX_PIN" ref="74a877edf512d1db6436bd850df92bd3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXAMPLE_USART_TX_PIN&nbsp;&nbsp;&nbsp;AVR32_USART1_TXD_0_0_PIN          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00007.html#l00105">105</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.
</div>
</div><p>
<a class="anchor" name="da3d11341169cdd062a138fd623d36a9"></a><!-- doxytag: member="pdca_example.c::PDCA_CHANNEL_USART_EXAMPLE" ref="da3d11341169cdd062a138fd623d36a9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PDCA_CHANNEL_USART_EXAMPLE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The channel instance for the USART example, here PDCA channel 0 (highest priority). 
<p>

<p>
Definition at line <a class="el" href="a00007.html#l00112">112</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>, and <a class="el" href="a00007.html#l00140">pdca_int_handler()</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="840291bc02cba5474a4cb46a9b9566fe"></a><!-- doxytag: member="pdca_example.c::main" ref="840291bc02cba5474a4cb46a9b9566fe" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The given example is a transfer of an ASCII animation stored in internal flash to the USART_0 output (57600 bps/8 data bits/no parity bit/1 stop bit/no flow control). 
<p>
This example uses the USART, GPIO, INTC and PDCA modules. 
<p>
Definition at line <a class="el" href="a00007.html#l00196">196</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
References <a class="el" href="a00007.html#l00118">ascii_anim1</a>, <a class="el" href="a00007.html#l00107">AVR32_PDCA_PID_USART_TX</a>, <a class="el" href="a00007.html#l00115">bool_anim</a>, <a class="el" href="a00007.html#l00102">EXAMPLE_USART</a>, <a class="el" href="a00007.html#l00104">EXAMPLE_USART_RX_FUNCTION</a>, <a class="el" href="a00007.html#l00103">EXAMPLE_USART_RX_PIN</a>, <a class="el" href="a00007.html#l00106">EXAMPLE_USART_TX_FUNCTION</a>, <a class="el" href="a00007.html#l00105">EXAMPLE_USART_TX_PIN</a>, <a class="el" href="a00007.html#l00112">PDCA_CHANNEL_USART_EXAMPLE</a>, <a class="el" href="a00005.html#l00089">pdca_enable()</a>, <a class="el" href="a00005.html#l00147">pdca_enable_interrupt_reload_counter_zero()</a>, <a class="el" href="a00005.html#l00049">pdca_get_handler()</a>, <a class="el" href="a00005.html#l00061">pdca_init_channel()</a>, <a class="el" href="a00006.html#l00053">PDCA_MODE_BYTE</a>, and <a class="el" href="a00007.html#l00159">pdca_set_irq()</a>.<div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198   <span class="keyword">volatile</span> avr32_pdca_channel_t *pdca_channel; <span class="comment">// get the correct channel pointer</span>
<a name="l00199"></a>00199   pdca_channel = <a class="code" href="a00002.html#379c460ae564ecbd85cf8103238306a8">pdca_get_handler</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>); <span class="comment">// get the correct channel pointer</span>
<a name="l00200"></a>00200 
<a name="l00201"></a>00201   <span class="comment">// Switch to OSC0 as source of main clock.</span>
<a name="l00202"></a>00202   pm_switch_to_osc0(&amp;AVR32_PM, FOSC0, OSC0_STARTUP);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <span class="comment">// As this program and the ASCII animation are loaded in internal Flash,</span>
<a name="l00205"></a>00205   <span class="comment">// both the CPU instruction master and the PDCA master interface will access the flash at the same time.</span>
<a name="l00206"></a>00206   <span class="comment">//</span>
<a name="l00207"></a>00207   <span class="comment">// In order to avoid long slave handling during undefined length bursts (INCR), the Bus Matrix</span>
<a name="l00208"></a>00208   <span class="comment">// provides specific logic in order to re-arbitrate before the end of the INCR transfer.</span>
<a name="l00209"></a>00209   <span class="comment">//</span>
<a name="l00210"></a>00210   <span class="comment">// HSB Bus Matrix: By default the HSB bus matrix mode is in Undefined length burst type (INCR).</span>
<a name="l00211"></a>00211   <span class="comment">// Here we have to put in single access (the undefined length burst is treated as a succession of single</span>
<a name="l00212"></a>00212   <span class="comment">// accesses, allowing re-arbitration at each beat of the INCR burst.</span>
<a name="l00213"></a>00213   <span class="comment">// Refer to the HSB bus matrix section of the datasheet for more details.</span>
<a name="l00214"></a>00214   <span class="comment">//</span>
<a name="l00215"></a>00215   <span class="comment">// HSB Bus matrix register MCFG1 is associated with the CPU instruction master interface.</span>
<a name="l00216"></a>00216   AVR32_HMATRIX.mcfg[1] = 0x1;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="comment">// Init counter for PDCA interrupt.</span>
<a name="l00219"></a>00219   <a class="code" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a>=1;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <span class="keyword">static</span> <span class="keyword">const</span> gpio_map_t USART_GPIO_MAP =
<a name="l00222"></a>00222   {
<a name="l00223"></a>00223     {<a class="code" href="a00004.html#9457549f9c382c57a9aa13845d8698b4">EXAMPLE_USART_RX_PIN</a>, <a class="code" href="a00004.html#5a55aeab727aefc9cb401af6876342e8">EXAMPLE_USART_RX_FUNCTION</a>},
<a name="l00224"></a>00224     {<a class="code" href="a00004.html#74a877edf512d1db6436bd850df92bd3">EXAMPLE_USART_TX_PIN</a>, <a class="code" href="a00004.html#aa125c5e06106b6aa2cf639a1f8360f6">EXAMPLE_USART_TX_FUNCTION</a>}
<a name="l00225"></a>00225   };
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   <span class="comment">// USART options.</span>
<a name="l00228"></a>00228   <span class="keyword">static</span> <span class="keyword">const</span> usart_options_t USART_OPTIONS =
<a name="l00229"></a>00229   {
<a name="l00230"></a>00230     .baudrate    = 57600,
<a name="l00231"></a>00231     .charlength  = 8,
<a name="l00232"></a>00232     .paritytype  = USART_NO_PARITY,
<a name="l00233"></a>00233     .stopbits    = USART_1_STOPBIT,
<a name="l00234"></a>00234     .channelmode = USART_NORMAL_CHMODE,
<a name="l00235"></a>00235   };
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">// Assign GPIO pins to USART_0.</span>
<a name="l00238"></a>00238   gpio_enable_module(USART_GPIO_MAP,
<a name="l00239"></a>00239                      <span class="keyword">sizeof</span>(USART_GPIO_MAP) / <span class="keyword">sizeof</span>(USART_GPIO_MAP[0]));
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <span class="comment">// Initialize the USART_0 in RS232 mode.</span>
<a name="l00242"></a>00242   usart_init_rs232(<a class="code" href="a00004.html#ca4339137112ed9bb3eb16fc2c51c64d">EXAMPLE_USART</a>, &amp;USART_OPTIONS, FOSC0);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   usart_write_line(<a class="code" href="a00004.html#ca4339137112ed9bb3eb16fc2c51c64d">EXAMPLE_USART</a>, <span class="stringliteral">"PDCA Example.\n"</span>);  
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">// PDCA channel options</span>
<a name="l00247"></a>00247   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="a00001.html">pdca_channel_options_t</a> PDCA_OPTIONS =
<a name="l00248"></a>00248   {
<a name="l00249"></a>00249     .addr = (<span class="keywordtype">unsigned</span> int) &amp;<a class="code" href="a00004.html#dee40b6ccff7aa7ca270f786d0a88a5a">ascii_anim1</a>,   <span class="comment">// memory address</span>
<a name="l00250"></a>00250     .pid = <a class="code" href="a00004.html#37f0c109086007dbcc10f036c3786337">AVR32_PDCA_PID_USART_TX</a>,       <span class="comment">// select peripheral - data are transmit on USART TX line.</span>
<a name="l00251"></a>00251     .size = <span class="keyword">sizeof</span>(<a class="code" href="a00004.html#dee40b6ccff7aa7ca270f786d0a88a5a">ascii_anim1</a>),           <span class="comment">// transfer counter</span>
<a name="l00252"></a>00252     .r_addr = 0, <span class="comment">// next memory address</span>
<a name="l00253"></a>00253     .r_size = 0,       <span class="comment">// next transfer counter</span>
<a name="l00254"></a>00254     .mode = <a class="code" href="a00003.html#286e201ddf4df68bea535b9eb1c1130b">PDCA_MODE_BYTE</a>,                <span class="comment">// select size of the transfer</span>
<a name="l00255"></a>00255   };
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="comment">// Init PDCA channel with the pdca_options.</span>
<a name="l00258"></a>00258   <a class="code" href="a00002.html#1fb3dc3930e4165c6dd1e53efb5b18cb">pdca_init_channel</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>, &amp;PDCA_OPTIONS); <span class="comment">// init PDCA channel with options.</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="comment">// Register PDCA IRQ interrupt.</span>
<a name="l00261"></a>00261   <a class="code" href="a00004.html#db5aa8d6135145ebbb865efee1c64505">pdca_set_irq</a>();
<a name="l00262"></a>00262   
<a name="l00263"></a>00263   <span class="comment">// Enable pdca interrupt each time the reload counter reaches zero, i.e. each time</span>
<a name="l00264"></a>00264   <span class="comment">// half of the ASCII animation (either anim1 or anim2) is transferred.</span>
<a name="l00265"></a>00265   <a class="code" href="a00002.html#0a2890205513365e9bcf77d368a1ea48">pdca_enable_interrupt_reload_counter_zero</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="comment">// Enable now the transfer.</span>
<a name="l00268"></a>00268   <a class="code" href="a00002.html#89ce9ac6b1430a359bd9b16239b41e67">pdca_enable</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   <span class="keywordflow">while</span> (1); <span class="comment">// wait for the PDCA interrupt</span>
<a name="l00271"></a>00271 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="794e33cd4b50968a9efa652c534d663d"></a><!-- doxytag: member="pdca_example.c::pdca_int_handler" ref="794e33cd4b50968a9efa652c534d663d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void pdca_int_handler           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The PDCA interrupt handler. 
<p>
The handler reload the PDCA settings with the correct ASCII animation address and size using the reload register. The interrupt will happen each time half of the animation is played. Let's use interrupt level 0 in the example. 
<p>
Definition at line <a class="el" href="a00007.html#l00140">140</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
References <a class="el" href="a00007.html#l00118">ascii_anim1</a>, <a class="el" href="a00007.html#l00123">ascii_anim2</a>, <a class="el" href="a00007.html#l00115">bool_anim</a>, <a class="el" href="a00007.html#l00112">PDCA_CHANNEL_USART_EXAMPLE</a>, and <a class="el" href="a00005.html#l00171">pdca_reload_channel()</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00159">pdca_set_irq()</a>.<div class="fragment"><pre class="fragment"><a name="l00141"></a>00141 {
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="keywordflow">if</span> (<a class="code" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a> == 1)
<a name="l00144"></a>00144   {
<a name="l00145"></a>00145     <span class="comment">// Set PDCA channel reload values with address where data to load are stored, and size of the data block to load.</span>
<a name="l00146"></a>00146     <a class="code" href="a00002.html#652d6ad48f3cdcabc2ac2941ae030c56">pdca_reload_channel</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)&amp;<a class="code" href="a00004.html#0b8d870b2016ada3230ceed66efa8af6">ascii_anim2</a>, <span class="keyword">sizeof</span>( ascii_anim2 ));
<a name="l00147"></a>00147     <a class="code" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a> = 2;
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a> == 2)
<a name="l00150"></a>00150   {
<a name="l00151"></a>00151     <a class="code" href="a00002.html#652d6ad48f3cdcabc2ac2941ae030c56">pdca_reload_channel</a>(<a class="code" href="a00004.html#da3d11341169cdd062a138fd623d36a9">PDCA_CHANNEL_USART_EXAMPLE</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)&amp;<a class="code" href="a00004.html#dee40b6ccff7aa7ca270f786d0a88a5a">ascii_anim1</a>, <span class="keyword">sizeof</span>( ascii_anim1 ));
<a name="l00152"></a>00152     <a class="code" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a> = 1;
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="db5aa8d6135145ebbb865efee1c64505"></a><!-- doxytag: member="pdca_example.c::pdca_set_irq" ref="db5aa8d6135145ebbb865efee1c64505" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pdca_set_irq           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Init interrupt controller and register pdca_int_handler interrupt. 
<p>

<p>
Definition at line <a class="el" href="a00007.html#l00159">159</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
References <a class="el" href="a00007.html#l00140">pdca_int_handler()</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00160"></a>00160 {
<a name="l00161"></a>00161 <span class="preprocessor">#if __GNUC__</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>  <span class="comment">// Disable all interrupt/exception.</span>
<a name="l00163"></a>00163   Disable_global_interrupt();
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   INTC_init_interrupts();
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="comment">// Register the compare interrupt handler to the interrupt controller</span>
<a name="l00168"></a>00168   <span class="comment">// and enable the compare interrupt.</span>
<a name="l00169"></a>00169   <span class="comment">// (__int_handler) &amp;pdca_int_handler The handler function to register.</span>
<a name="l00170"></a>00170   <span class="comment">// AVR32_PDCA_IRQ_0 The interrupt line to register to.</span>
<a name="l00171"></a>00171   <span class="comment">// INT0  The priority level to set for this interrupt line.</span>
<a name="l00172"></a>00172   <span class="comment">// INTC_register_interrupt(__int_handler handler, int line, int priority);</span>
<a name="l00173"></a>00173   INTC_register_interrupt( (__int_handler) &amp;<a class="code" href="a00004.html#794e33cd4b50968a9efa652c534d663d">pdca_int_handler</a>, AVR32_PDCA_IRQ_0, INT0);
<a name="l00174"></a>00174 <span class="preprocessor">#endif</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176   <span class="comment">// Enable all interrupt/exception.</span>
<a name="l00177"></a>00177   Enable_global_interrupt();
<a name="l00178"></a>00178 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2227072d15c6c4f0897c8d3e887eb961"></a><!-- doxytag: member="pdca_example.c::usart_check_tx_status" ref="2227072d15c6c4f0897c8d3e887eb961" args="(volatile avr32_usart_t *usart)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int usart_check_tx_status           </td>
          <td>(</td>
          <td class="paramtype">volatile avr32_usart_t *&nbsp;</td>
          <td class="paramname"> <em>usart</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
USART test if transmit buffer is ready before launching a PDCA transfer. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>usart</em>&nbsp;</td><td>Pointer to a avr32_usart_t </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00007.html#l00185">185</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.<div class="fragment"><pre class="fragment"><a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (usart-&gt;csr &amp; (1&lt;&lt;AVR32_USART_CSR_TXEMPTY_OFFSET)) <span class="keywordflow">return</span> USART_SUCCESS;
<a name="l00188"></a>00188   <span class="keywordflow">else</span> <span class="keywordflow">return</span> USART_TX_BUSY;
<a name="l00189"></a>00189 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="dee40b6ccff7aa7ca270f786d0a88a5a"></a><!-- doxytag: member="pdca_example.c::ascii_anim1" ref="dee40b6ccff7aa7ca270f786d0a88a5a" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="a00004.html#dee40b6ccff7aa7ca270f786d0a88a5a">ascii_anim1</a>[]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="preprocessor"># 119 "d:/soft/cygwin_homedir/ppatron/WORK_SVN132/apps/software/swlib/release/AT32UC3-1.1.1/AT32UC3B-1.1.1/DRIVERS/PDCA/EXAMPLE/pdca_example.c" 2</span>
</pre></div>String for ASCII animation: this is the first part of the ASCII animation. 
<p>

<p>
Definition at line <a class="el" href="a00007.html#l00118">118</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>, and <a class="el" href="a00007.html#l00140">pdca_int_handler()</a>.
</div>
</div><p>
<a class="anchor" name="0b8d870b2016ada3230ceed66efa8af6"></a><!-- doxytag: member="pdca_example.c::ascii_anim2" ref="0b8d870b2016ada3230ceed66efa8af6" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="a00004.html#0b8d870b2016ada3230ceed66efa8af6">ascii_anim2</a>[]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="preprocessor"># 124 "d:/soft/cygwin_homedir/ppatron/WORK_SVN132/apps/software/swlib/release/AT32UC3-1.1.1/AT32UC3B-1.1.1/DRIVERS/PDCA/EXAMPLE/pdca_example.c" 2</span>
</pre></div>String for ASCII animation: this is the second and final part of the ASCII animation. 
<p>

<p>
Definition at line <a class="el" href="a00007.html#l00123">123</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00140">pdca_int_handler()</a>.
</div>
</div><p>
<a class="anchor" name="a54dec3315fe8cf32a47d6ab284e5928"></a><!-- doxytag: member="pdca_example.c::bool_anim" ref="a54dec3315fe8cf32a47d6ab284e5928" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile int <a class="el" href="a00004.html#a54dec3315fe8cf32a47d6ab284e5928">bool_anim</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Counter for interrupt test. 
<p>

<p>
Definition at line <a class="el" href="a00007.html#l00115">115</a> of file <a class="el" href="a00007.html">pdca_example.c</a>.
<p>
Referenced by <a class="el" href="a00007.html#l00196">main()</a>, and <a class="el" href="a00007.html#l00140">pdca_int_handler()</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Thu Sep 20 12:12:49 2007 for AVR32 - PDCA Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
